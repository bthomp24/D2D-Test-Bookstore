{% extends "base_sidebar.html" %}

{% block content %}

<div class="column middle" style="background-color:white;">
    <div class="flex-heading">
        <h1>Results Found In:</h1>
        <a href="{% url 'search' %}" class="flex-child-last">
            <button type="button" class="back-button">
                <span>Back</span>
            </button>
        </a>
    </div>
    {% for site in site_list %}
        <h2 class="site-name">{{ site.name }}:</h2>
        {% if site.books|length > 1 %}
            {% for book in site.books %}
                {% if forloop.first %}
                    <a href="{{ book.link }}" target="_blank" class="book-link">
                        <div class="flex-content">
                            <img src="https://miro.medium.com/max/1400/1*p4JUDVX5XfyFoxXFh_XTjQ.png" height="96" width="60">
                            <div class="flex-child-first">
                                <p title="{{ book.name }}">{{ book.name|truncatechars:60 }}</p>
                            {% if ',' in book.author %}
                                <p title="{{ book.author }}">Authors: {{ book.author|truncatechars:50 }}</p>
                            {% else %}
                                <p title="{{ book.author }}">Author: {{ book.author|truncatechars:50 }}</p>
                            {% endif %}
                            </div>
                            <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                        </div>
                    </a>

                    <button class="accordion">More Results</button>
                    <div class="panel">
                {% elif forloop.last %}
                        <a href="{{ book.link }}" target="_blank" class="book-link">
                            <div class="flex-content">
                                <img src="https://miro.medium.com/max/1400/1*p4JUDVX5XfyFoxXFh_XTjQ.png" height="96" width="60">
                                <div class="flex-child-first">
                                    <p title="{{ book.name }}">{{ book.name|truncatechars:30 }}</p>
                                {% if ',' in book.author %}
                                    <p title="{{ book.author }}">Authors: {{ book.author|truncatechars:24 }}</p>
                                {% else %}
                                    <p title="{{ book.author }}">Author: {{ book.author|truncatechars:25 }}</p>
                                {% endif %}
                                </div>
                                <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                            </div>
                        </a>
                    </div>
                {% else %}
                        <a href="{{ book.link }}" target="_blank" class="book-link">
                            <div class="flex-content">
                                <img src="https://miro.medium.com/max/1400/1*p4JUDVX5XfyFoxXFh_XTjQ.png" height="96" width="60">
                                <div class="flex-child-first">
                                    <p title="{{ book.name }}">{{ book.name|truncatechars:30 }}</p>
                                {% if ',' in book.author %}
                                    <p title="{{ book.author }}">Authors: {{ book.author|truncatechars:24 }}</p>
                                {% else %}
                                    <p title="{{ book.author }}">Author: {{ book.author|truncatechars:25 }}</p>
                                {% endif %}
                                </div>
                                <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                            </div>
                        </a>
                {% endif %}
            {% endfor %}
        {% elif site.books|length == 1 %}
            {% for book in site.books %}
                <a href="{{ book.link }}" target="_blank" class="book-link">
                    <div class="flex-content">
                        <img  src="https://miro.medium.com/max/1400/1*p4JUDVX5XfyFoxXFh_XTjQ.png" height="96" width="60" >
                        <div class="flex-child-first">
                            <p title="{{ book.name }}">{{ book.name|truncatechars:60 }}</p>
                        {% if ',' in book.author %}
                            <p title="{{ book.author }}">Authors: {{ book.author|truncatechars:49 }}</p>
                        {% else %}
                            <p title="{{ book.author }}">Author: {{ book.author|truncatechars:50 }}</p>
                        {% endif %}
                        </div>
                        <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="empty-results">No Results Found</p>
        {% endif %}
    {% endfor %}
</div>

{% endblock %}