{% extends "base_sidebar.html" %}

{% block content %}

<div id="columnMiddle" class="column middle" style="background-color:white;">
    <h1>Results Found In:</h1>
    {% for site in site_list %}
        <h2 class="site-name">{{ site.name }}:</h2>
        {% if site.books|length > 1 %}
            {% for book in site.books %}
                {% if forloop.first %}
                    <a href="{{ book.link }}" target="_blank" class="book-link">
                        <div class="flex-content">
                        {% if book.cover == None or book.cover|length < 1 %}
                            <img src="http://www.lse.ac.uk/International-History/Images/Books/NoBookCover.png" height="96" width="60">
                        {% else %}
                            <img src="{{ book.cover }}" height="96" width="60">
                        {% endif %}
                            <div class="flex-child-first">
                                <p class="flex-child-first-child" title="{{ book.name }}">{{ book.name|truncatechars:70 }}</p>
                                <p class="flex-child-first-child" title="{{ book.author }}">By: {{ book.author|truncatechars:67 }}</p>
                            </div>
                            <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                        </div>
                    </a>

                    <button class="accordion">More Results</button>
                    <div class="panel">
                {% elif forloop.last %}
                        <a href="{{ book.link }}" target="_blank" class="book-link">
                            <div class="flex-content">
                            {% if book.cover == None or book.cover|length < 1 %}
                                <img src="http://www.lse.ac.uk/International-History/Images/Books/NoBookCover.png" height="96" width="60">
                            {% else %}
                                <img src="{{ book.cover }}" height="96" width="60">
                            {% endif %}
                                <div class="flex-child-first">
                                    <p class="flex-child-first-child" title="{{ book.name }}">{{ book.name|truncatechars:40 }}</p>
                                    <p class="flex-child-first-child" title="{{ book.author }}">By: {{ book.author|truncatechars:37 }}</p>
                                </div>
                                <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                            </div>
                        </a>
                    </div>
                {% else %}
                        <a href="{{ book.link }}" target="_blank" class="book-link">
                            <div class="flex-content">
                            {% if book.cover == None or book.cover|length < 1 %}
                                <img src="http://www.lse.ac.uk/International-History/Images/Books/NoBookCover.png" height="96" width="60">
                            {% else %}
                                <img src="{{ book.cover }}" height="96" width="60">
                            {% endif %}
                                <div class="flex-child-first">
                                    <p class="flex-child-first-child" title="{{ book.name }}">{{ book.name|truncatechars:40 }}</p>
                                    <p class="flex-child-first-child" title="{{ book.author }}">By: {{ book.author|truncatechars:37 }}</p>
                                </div>
                                <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                            </div>
                        </a>
                {% endif %}
            {% endfor %}
        {% elif site.books|length == 1 %}
            {% for book in site.books %}
                <a href="{{ book.link }}" target="_blank" class="book-link">
                    <div class="flex-content">
                    {% if book.cover == None or book.cover|length < 1 %}
                        <img src="http://www.lse.ac.uk/International-History/Images/Books/NoBookCover.png" height="96" width="60">
                    {% else %}
                        <img src="{{ book.cover }}" height="96" width="60">
                    {% endif %}
                        <div class="flex-child-first">
                            <p class="flex-child-first-child" title="{{ book.name }}">{{ book.name|truncatechars:70 }}</p>
                            <p class="flex-child-first-child" title="{{ book.author }}">By: {{ book.author|truncatechars:67 }}</p>
                        </div>
                        <p class="flex-child-last">Rating: {{ book.rating }}%</p>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="empty-results">No Results Found</p>
        {% endif %}
    {% endfor %}
</div>
<script>
    $("#columnMiddle").append('<div id="loading"><div id="loading-items"><p class="loading-top">Gathering Information...</p><i class= "fa fa-spinner fa-pulse fa-3x"></i><p class="loading-bottom">Please Wait.</p></div></div>');
    $(window).on('load', function () {
      setTimeout(removeLoader, 1000); //wait for page load PLUS two seconds.
    });
    function removeLoader() {
      $("#loading").fadeOut(500, function () {
        // fadeOut complete. Remove the loading div
        $("#loading").remove(); //makes page more lightweight 
      });
    }
</script>

{% endblock %}